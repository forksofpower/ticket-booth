apiVersion: skaffold/v4beta6
kind: Config
manifests:
  rawYaml:
    - infra/k8s/*
deploy:
  kubectl: {}

build:
  local:
    push: false
  artifacts:
    - image: forksofpower/tb-auth
      context: services/auth

    - image: forksofpower/tb-client
      context: services/client
      docker:
        target: production

    - image: forksofpower/tb-tickets
      context: services/tickets

    - image: forksofpower/tb-payments
      context: services/payments

    - image: forksofpower/tb-expiration
      context: services/expiration

    - image: forksofpower/tb-orders
      context: services/orders

profiles:
  - name: dev
    activation:
      - command: dev
    build:
      local:
        push: false
      artifacts:
        - image: forksofpower/tb-auth
          context: services/auth
          sync: &common-sync
            manual:
              - src: "**/*.{ts,js,json}"
                dest: "app/"

        - image: forksofpower/tb-client
          context: services/client
          docker:
            target: development
          sync:
            manual:
              - src: "**/*.{ts,tsx,js,jsx,json}"
                dest: "app/"

        - image: forksofpower/tb-tickets
          context: services/tickets
          sync: *common-sync

        - image: forksofpower/tb-payments
          context: services/payments
          sync: *common-sync

        - image: forksofpower/tb-expiration
          context: services/expiration
          sync: *common-sync

        - image: forksofpower/tb-orders
          context: services/orders
          sync: *common-sync
